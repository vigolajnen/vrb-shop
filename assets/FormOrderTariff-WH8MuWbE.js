import{r as b,j as e}from"./react-dOK_llRH.js";import{g as J}from"./react-router-hd1aWLNq.js";import{u as k,a as U,F as X}from"./react-hook-form-Nk53eNSS.js";import{c as g}from"./classnames-G66vBsBY.js";import{E as Y}from"./react-error-boundary-wkjsgIbD.js";import{F as s,O as z,b as K,R as Q,a as L}from"./react-bootstrap-NBDFt7o7.js";import{R as W}from"./react-input-mask-baMkAzyy.js";import{i as Z,m as ee,a as se,R as te,b as re,v as ae,p as le,o as D}from"./index-L-l33fTx.js";import{S as ie,u as ne}from"./useActions--LnaBO-m.js";import{C as oe}from"./CityContext-b-BUd9tP.js";import{u as q}from"./useTypedSelector-OiAJGiMZ.js";import{g as I}from"./tariffs-Bu4Q073w.js";import{L as C}from"./react-router-dom-xnPv3tiZ.js";import{E as ce}from"./ErrorsFallback-hw0r2hzp.js";import{B as P}from"./ButtonGradient-q2EJEL5_.js";import"./@remix-run-R0A6g4pJ.js";import"./@restart--YlOOCn5.js";import"./dom-helpers--nlGJCCs.js";import"./@react-aria-0uNWp7yg.js";import"./react-dom-ZjE40EjR.js";import"./scheduler-iwWdm5Ml.js";import"./dequal-vEqHzq4I.js";import"./@popperjs-u7bcf535.js";import"./warning-lhFwPr5I.js";import"./uncontrollable-BgYfu1sR.js";import"./@babel-o_ZSNJgm.js";import"./react-transition-group-hXqudQ2I.js";import"./prop-types-fuYWWnMu.js";import"./react-redux-k4q0NQ3n.js";import"./use-sync-external-store-ABTd-lK_.js";import"./framer-motion-90-YAChi.js";import"./react-helmet-async-VV9_8hgh.js";import"./react-fast-compare-v43NpY3q.js";import"./invariant-bxtdRYLJ.js";import"./shallowequal-PLp_r1sp.js";import"./@reduxjs-LZSxCC61.js";import"./redux-1vRRQ9xr.js";import"./immer-2oJgyI5v.js";import"./reselect-vVLqgz1U.js";import"./redux-thunk-qyK_zz9Y.js";const de="_label_dg7fw_1",me="_control_dg7fw_8",pe="_stepper_dg7fw_19",ue="_stepperItem_dg7fw_40",xe="_active_dg7fw_64",he="_labelCheck_dg7fw_72",je="_link_dg7fw_76",be="_buttonNext_dg7fw_84",a={label:de,control:me,stepper:pe,stepperItem:ue,active:xe,labelCheck:he,link:je,buttonNext:be},fe=()=>{const{register:r,setFocus:t,formState:{errors:l}}=k();return b.useEffect(()=>{t("firstName")},[t]),e.jsxs(e.Fragment,{children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:a.label,children:"Имя"}),e.jsx(s.Control,{type:"text",id:"first_name",placeholder:"Имя",className:a.control,...r("firstName",{required:!0,minLength:2})}),l.firstName&&e.jsx(s.Text,{className:"text-danger",children:"Пожалуйста, введите ваше имя"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:a.label,children:"Номер телефона"}),e.jsx(W,{id:"phone",type:"tel",className:g(a.control,"form-control"),mask:"+7(999) 999-99-99",alwaysShowMask:!0,...r("phone",{validate:{inputTelRequired:Z}})}),l.phone&&e.jsx(s.Text,{className:"text-danger",children:"Пожалуйста, введите ваш телефон"})]})]})},Ne="_button_de7o2_1",_e={button:Ne};function ye(){const r="Услуга не может быть оказана лицам моложе 14 лет",t=l=>e.jsx(K,{id:"button-tooltip",...l,children:r});return e.jsx(z,{placement:"top",delay:{show:250,hide:400},overlay:t,children:e.jsx("button",{type:"button",className:_e.button,"aria-label":r,children:e.jsx(ie,{width:20,height:20})})})}const ge=({data:r,item:t})=>{var c;const l=ee().toString(),n=se().toString(),u=b.useContext(oe),{tariffsActiveTab:d,clubsMC:x}=q(j=>j.price),f=u===te.spb.name&&(d.toLocaleLowerCase()==="с бассейном"||t.type==="mc_full"),_=[];x.length>0&&_.push(I(x,["mc_full"]));const N=(c=_.flat(1/0)[0])==null?void 0:c.clubs;t.type==="mc_full"&&(t.clubs=N,t.countClubs=N.length);const{register:h,setFocus:i,formState:{errors:m}}=k();if(b.useEffect(()=>{i("lastName")},[i]),!r)throw new Error("Нет данных");if(!t)throw new Error("Нет данных");return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{children:[e.jsx(L,{xs:12,sm:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:a.label,children:"Имя"}),e.jsx(s.Control,{type:"text",name:"first_name",placeholder:"Имя",id:"firstName",value:r.firstName,readOnly:!0,className:a.control})]})}),e.jsx(L,{xs:12,sm:6,children:e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:a.label,children:"Фамилия"}),e.jsx(s.Control,{type:"text",placeholder:"Фамилия",className:a.control,id:"lastName",required:!0,...h("lastName",{required:!0,minLength:2})}),m.lastName&&e.jsx(s.Text,{className:"text-danger",children:"Пожалуйста, введите вашу фамилию"})]})})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:a.label,children:"Выберите клуб"}),f&&e.jsx("small",{className:"mb-1 d-flex",children:"Кроме клубов Фитнес Хаус Престиж (ул. Барочная, д.10/2Б, ул. Я. Гашека, 17А, Шереметьевская ул., 13А)"}),e.jsxs(s.Select,{"aria-label":"Выберите клуб",className:a.control,required:!0,...h("club_id",{required:!0}),children:[e.jsx("option",{value:"",children:"Выберете клуб"}),(t==null?void 0:t.clubs.length)>0?[...t.clubs].map(j=>e.jsx("option",{value:j.id,children:j.address},j.address)):null]}),m.club_id&&e.jsx(s.Text,{className:"text-danger",children:"Пожалуйста, выберите клуб"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:a.label,children:"Номер телефона"}),e.jsx(s.Control,{type:"tel",name:"phone",className:a.control,id:"phone",value:r.phone,readOnly:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsxs(s.Label,{className:a.label,children:["Дата рождения ",e.jsx(ye,{})]}),e.jsx(s.Control,{type:"date",className:a.control,id:"customer_birth_day",min:n,max:l,required:!0,...h("birth_day",{required:!0,min:n,max:l,validate:{inputBirthDayRequired:re}})}),m.birth_day&&e.jsx(s.Text,{className:"text-danger",children:"Пожалуйста, введите вашу дату рождения"})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{className:a.label,children:"Email"}),e.jsx(s.Control,{type:"email",placeholder:"Email",className:a.control,id:"email",required:!0,...h("email",{required:!0,validate:{inputEmailRequired:ae}})}),m.email&&e.jsx(s.Text,{className:"text-danger",children:"Пожалуйста, введите ваш email"})]})]})},Ce="_list_u80dj_1",ke="_item_u80dj_8",Te="_text_u80dj_15",we="_price_u80dj_20",p={list:Ce,item:ke,text:Te,price:we},Se=({price:r,club:t})=>{const{address:l,name:n,product:u,first_pay:d}=t,x=d[0]!==void 0?d[0].product_price:0,f=+r+ +x;return e.jsxs("div",{className:"py-2 p-sm-2",children:[e.jsxs("ul",{className:p.list,children:[e.jsxs("li",{className:g(p.item,"d-flex flex-column my-1 p-0 align-items-start"),children:[e.jsx("span",{children:"Наименование тарифа"}),e.jsx("span",{children:e.jsx("b",{children:u.product_name})})]}),e.jsxs("li",{className:g(p.item,"d-flex flex-column my-1 p-0 align-items-start"),children:[e.jsx("span",{children:"Основной клуб"}),e.jsxs("span",{children:[e.jsx("b",{children:n}),", ",e.jsx("b",{children:l})]})]}),e.jsxs("li",{className:p.item,children:[e.jsx("span",{children:"Стоимость тарифа"}),e.jsxs("span",{className:p.price,children:[e.jsx("b",{children:r})," ",e.jsx("small",{children:"₽"})]})]}),e.jsxs("li",{className:p.item,children:[e.jsx("span",{children:"Первоначальный платеж"}),e.jsxs("span",{className:p.price,children:[e.jsx("b",{children:x})," ",e.jsx("small",{children:"₽"})]})]}),e.jsxs("li",{className:p.item,children:[e.jsxs("span",{children:[e.jsx("b",{children:"Итого:"}),e.jsx("br",{}),"к оплате за первый месяц"]}),e.jsxs("span",{className:p.price,children:[e.jsx("b",{children:f})," ",e.jsx("small",{children:"₽"})]})]})]}),e.jsxs("p",{className:p.text,children:["Ежемесячное списание Подписки со второго месяца будет равно стоимости Вашего тарифа ",r," ₽"]})]})};function ve({price:r,id:t,item:l}){const n=l.clubs.filter(u=>u.id===t);if(!n)throw new Error("Нет данных по клубу");return e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Se,{price:r,club:n[0]})})}const Fe=()=>{const{register:r,formState:{errors:t}}=k();return e.jsx(e.Fragment,{children:e.jsxs(s.Check,{type:"checkbox",id:"checkbox",children:[e.jsx(s.Check.Input,{type:"checkbox",...r("isCheck",{required:!0})}),e.jsxs(s.Check.Label,{className:a.labelCheck,children:["Я ознакомлен(-на) и согласен(-на) с условиями"," ",e.jsx(C,{to:"/",className:a.link,target:"_blank",rel:"noreferrer",children:"Договора Оферты"}),","," ",e.jsx(C,{to:"/",className:a.link,target:"_blank",rel:"noreferrer",children:"Правилами Клуба"})," ","и даю своё согласие на"," ",e.jsx(C,{to:"/",className:a.link,target:"_blank",rel:"noreferrer",children:"обработку персональных данных"}),"."]}),t.isCheck&&e.jsx(s.Text,{className:"text-danger",children:"Пожалуйста, заполните поле"})]})})},R=new Headers;R.append("Content-Type","application/json");const Ee=le.injectEndpoints({endpoints:r=>({createOrder:r.mutation({query:t=>({headers:R,redirect:"follow",url:window.location.hostname==="localhost"?"http://127.0.0.1:4173/payments/orders/":window.location.origin+"/payments/orders/",method:"POST",body:JSON.stringify(t),validateStatus:(l,n)=>(console.log(l),n.pay_url&&(window.location=n.pay_url),l.status===200||l.status===302)}),extraOptions:{maxRetries:1},transformResponse:t=>t.body})}),overrideExisting:!1}),{useCreateOrderMutation:Le}=Ee,O={firstName:"",lastName:"",phone:"",email:"",birth_day:"",club_id:"",isCheck:!1},De=({item:r})=>{const t=b.useRef(null),[l,n]=b.useState(!1),{getProductsPosition:u,getClubsPositions:d,getProductsPositionFirstPay:x,getFormData:f,getCustomer:_}=ne(),[N]=Le(),h=[1,2,3],[i,m]=b.useState(1),[c,j]=b.useState(O),[G,B]=b.useState(""),T=U({mode:"all"}),{formState:{isValid:w,isDirty:S},watch:y,reset:A}=T,M=()=>{m(o=>o+1)},V=o=>{o=y(),j(o),M(),f(y()),i===2&&(D(c,o,r),B(o.club_id))},v=o=>{var F;(F=t==null?void 0:t.current)==null||F.addEventListener("click",()=>{var E;return(E=t==null?void 0:t.current)==null?void 0:E.setAttribute("disabled","true")}),o=y(),f(y()),_(),d(r.clubs),u(r),x(o.club_id),n(!0);const $=D(c,o,r);N($),A(),j(O),m(3),n(!1)},H=()=>i>3?null:i===3?e.jsx(Y,{FallbackComponent:ce,children:e.jsx(P,{onClick:v,outline:!0,style:"w-100 d-block",type:"button",disabled:!w||!S,children:"Оплатить"})}):e.jsx("div",{className:"d-flex",children:e.jsx(P,{onClick:V,outline:!0,style:"w-100 d-block",type:"button",disabled:!w||!S,children:i===1?"Вперед":"Далее"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:a.stepper,children:h.map(o=>e.jsx("div",{className:o<=i?g(a.stepperItem,a.active):a.stepperItem,children:e.jsx("span",{children:o})},o))}),e.jsx(X,{...T,children:e.jsxs(s,{noValidate:!0,validated:l,onSubmit:v,children:[i>=1&&e.jsx("div",{className:i===1?"":"d-none",children:e.jsx(fe,{})}),i>=2&&e.jsx("div",{className:i===2?"":"d-none",children:e.jsx(ge,{data:c,item:r})}),i>=3&&e.jsx("div",{className:i===3?"":"d-none",children:e.jsx(ve,{price:r.price,id:G,item:r})}),H(),i<=2&&e.jsx("div",{className:i===2||i===1?"":"d-none",children:e.jsx(Fe,{})})]})})]})},Ns=()=>{var m;const r=J(),{clubsPoolYes:t,clubsPoolNo:l,clubsPremiere:n,tariffTypes:u,tariffsTabs:d,tariffsActiveTab:x}=q(c=>c.price),N=[{tab:d[0],list:n},{tab:d[1],list:t},{tab:d[2],list:l}].filter(c=>c.tab===x)[0].list,h=[];N.length>0&&h.push(I(N,u));const i=(m=h.flat(1))==null?void 0:m.find(c=>c.id===Number(r.id));return e.jsx(De,{item:i})};export{Ns as default};
