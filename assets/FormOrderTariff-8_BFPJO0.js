import{r as b,j as e}from"./react-dOK_llRH.js";import{g as U}from"./react-router-hd1aWLNq.js";import{u as S,a as X,F as Y}from"./react-hook-form-Nk53eNSS.js";import{c}from"./classnames-G66vBsBY.js";import{E as z}from"./react-error-boundary-wkjsgIbD.js";import{F as t,O as K,b as Q,R as W,a as D}from"./react-bootstrap-NBDFt7o7.js";import{R as Z}from"./react-input-mask-baMkAzyy.js";import{i as ee,m as te,a as se,R as re,b as ae,v as le,p as oe,o as P}from"./index-vQQ_LLMm.js";import{S as ne,u as ie}from"./tooltip-ureV0emd.js";import{C as ce}from"./CityContext-b-BUd9tP.js";import{u as q}from"./useTypedSelector-OiAJGiMZ.js";import{g as I}from"./tariffs-iOuaODXH.js";import{L as T}from"./react-router-dom-xnPv3tiZ.js";import{E as de}from"./ErrorsFallback-hw0r2hzp.js";import{B as w}from"./ButtonGradient-q2EJEL5_.js";import"./@remix-run-R0A6g4pJ.js";import"./@restart--YlOOCn5.js";import"./dom-helpers--nlGJCCs.js";import"./@react-aria-0uNWp7yg.js";import"./react-dom-ZjE40EjR.js";import"./scheduler-iwWdm5Ml.js";import"./dequal-vEqHzq4I.js";import"./@popperjs-u7bcf535.js";import"./warning-lhFwPr5I.js";import"./uncontrollable-BgYfu1sR.js";import"./@babel-o_ZSNJgm.js";import"./react-transition-group-hXqudQ2I.js";import"./prop-types-fuYWWnMu.js";import"./react-redux-k4q0NQ3n.js";import"./use-sync-external-store-ABTd-lK_.js";import"./framer-motion-90-YAChi.js";import"./react-helmet-async-VV9_8hgh.js";import"./react-fast-compare-v43NpY3q.js";import"./invariant-bxtdRYLJ.js";import"./shallowequal-PLp_r1sp.js";import"./@reduxjs-LZSxCC61.js";import"./redux-1vRRQ9xr.js";import"./immer-2oJgyI5v.js";import"./reselect-vVLqgz1U.js";import"./redux-thunk-qyK_zz9Y.js";const me="_label_dg7fw_1",pe="_control_dg7fw_8",ue="_stepper_dg7fw_19",xe="_stepperItem_dg7fw_40",he="_active_dg7fw_64",fe="_labelCheck_dg7fw_72",be="_link_dg7fw_76",je="_buttonNext_dg7fw_84",s={label:me,control:pe,stepper:ue,stepperItem:xe,active:he,labelCheck:fe,link:be,buttonNext:je},Ne=()=>{const{register:r,setFocus:a,formState:{errors:o}}=S();return b.useEffect(()=>{a("firstName")},[a]),e.jsxs(e.Fragment,{children:[e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{className:s.label,children:"Имя"}),e.jsx(t.Control,{type:"text",id:"first_name",placeholder:"Имя",className:o.firstName?c(s.control,"form-control is-invalid"):c(s.control,"form-control"),...r("firstName",{required:!0,minLength:2})}),o.firstName&&e.jsx(t.Text,{className:"text-danger",children:"Пожалуйста, введите ваше имя"})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{className:s.label,children:"Номер телефона"}),e.jsx(Z,{id:"phone",type:"tel",className:o.phone?c(s.control,"form-control is-invalid"):c(s.control,"form-control"),mask:"+7(999) 999-99-99",alwaysShowMask:!0,...r("phone",{validate:{inputTelRequired:ee}})}),o.phone&&e.jsx(t.Text,{className:"text-danger",children:"Пожалуйста, введите ваш телефон"})]})]})},_e="_button_de7o2_1",ge={button:_e};function ye(){const r="Услуга не может быть оказана лицам моложе 14 лет",a=o=>e.jsx(Q,{id:"button-tooltip",...o,children:r});return e.jsx(K,{placement:"top",delay:{show:250,hide:400},overlay:a,children:e.jsx("button",{type:"button",className:ge.button,"aria-label":r,children:e.jsx(ne,{width:20,height:20})})})}const ke=({data:r,item:a})=>{var d;const o=te().toString(),i=se().toString(),x=b.useContext(ce),{tariffsActiveTab:p,clubsMC:m}=q(f=>f.price),N=x===re.spb.name&&(p.toLocaleLowerCase()==="с бассейном"||a.type==="mc_full"),y=[];m.length>0&&y.push(I(m,["mc_full"]));const j=(d=y.flat(1/0)[0])==null?void 0:d.clubs;a.type==="mc_full"&&(a.clubs=j,a.countClubs=j.length);const{register:h,setFocus:_,formState:{errors:l}}=S();if(b.useEffect(()=>{_("lastName")},[_]),!r)throw new Error("Нет данных");if(!a)throw new Error("Нет данных");return e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[e.jsx(D,{xs:12,sm:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{className:s.label,children:"Имя"}),e.jsx(t.Control,{type:"text",name:"first_name",placeholder:"Имя",id:"firstName",value:r.firstName,readOnly:!0,className:s.control})]})}),e.jsx(D,{xs:12,sm:6,children:e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{className:s.label,children:"Фамилия"}),e.jsx(t.Control,{type:"text",placeholder:"Фамилия",className:l.lastName?c(s.control,"form-control is-invalid"):c(s.control,"form-control"),id:"lastName",required:!0,...h("lastName",{required:!0,minLength:2})}),l.lastName&&e.jsx(t.Text,{className:"text-danger",children:"Пожалуйста, введите вашу фамилию"})]})})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{className:s.label,children:"Выберите клуб"}),N&&e.jsx("small",{className:"mb-1 d-flex",children:"Кроме клубов Фитнес Хаус Престиж (ул. Барочная, д.10/2Б, ул. Я. Гашека, 17А, Шереметьевская ул., 13А)"}),e.jsxs(t.Select,{"aria-label":"Выберите клуб",className:l.club_id?c(s.control,"form-control is-invalid"):c(s.control,"form-control"),required:!0,...h("club_id",{required:!0}),children:[e.jsx("option",{value:"",children:"Выберете клуб"}),(a==null?void 0:a.clubs.length)>0?[...a.clubs].map(f=>e.jsx("option",{value:f.id,children:f.address},f.address)):null]}),l.club_id&&e.jsx(t.Text,{className:"text-danger",children:"Пожалуйста, выберите клуб"})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{className:s.label,children:"Номер телефона"}),e.jsx(t.Control,{type:"tel",name:"phone",className:s.control,id:"phone",value:r.phone,readOnly:!0})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsxs(t.Label,{className:s.label,children:["Дата рождения ",e.jsx(ye,{})]}),e.jsx(t.Control,{type:"date",className:l.birth_day?c(s.control,"form-control is-invalid"):c(s.control,"form-control"),id:"customer_birth_day",min:i,max:o,required:!0,...h("birth_day",{required:!0,min:i,max:o,validate:{inputBirthDayRequired:ae}})}),l.birth_day&&e.jsx(t.Text,{className:"text-danger",children:"Пожалуйста, введите вашу дату рождения"})]}),e.jsxs(t.Group,{className:"mb-3",children:[e.jsx(t.Label,{className:s.label,children:"Email"}),e.jsx(t.Control,{type:"email",placeholder:"Email",className:l.email?c(s.control,"form-control is-invalid"):c(s.control,"form-control"),id:"email",required:!0,...h("email",{required:!0,validate:{inputEmailRequired:le}})}),l.email&&e.jsx(t.Text,{className:"text-danger",children:"Пожалуйста, введите ваш email"})]})]})},Ce="_list_u80dj_1",ve="_item_u80dj_8",Te="_text_u80dj_15",we="_price_u80dj_20",u={list:Ce,item:ve,text:Te,price:we},Se=({price:r,club:a})=>{const{address:o,name:i,product:x,first_pay:p}=a,m=p[0]!==void 0?p[0].product_price:0,N=+r+ +m;return e.jsxs("div",{className:"py-2 p-sm-2",children:[e.jsxs("ul",{className:u.list,children:[e.jsxs("li",{className:c(u.item,"d-flex flex-column my-1 p-0 align-items-start"),children:[e.jsx("span",{children:"Наименование тарифа"}),e.jsx("span",{children:e.jsx("b",{children:x.product_name})})]}),e.jsxs("li",{className:c(u.item,"d-flex flex-column my-1 p-0 align-items-start"),children:[e.jsx("span",{children:"Основной клуб"}),e.jsxs("span",{children:[e.jsx("b",{children:i}),", ",e.jsx("b",{children:o})]})]}),e.jsxs("li",{className:u.item,children:[e.jsx("span",{children:"Стоимость тарифа"}),e.jsxs("span",{className:u.price,children:[e.jsx("b",{children:r})," ",e.jsx("small",{children:"₽"})]})]}),e.jsxs("li",{className:u.item,children:[e.jsx("span",{children:"Первоначальный платеж"}),e.jsxs("span",{className:u.price,children:[e.jsx("b",{children:m})," ",e.jsx("small",{children:"₽"})]})]}),e.jsxs("li",{className:u.item,children:[e.jsxs("span",{children:[e.jsx("b",{children:"Итого:"}),e.jsx("br",{}),"к оплате за первый месяц"]}),e.jsxs("span",{className:u.price,children:[e.jsx("b",{children:N})," ",e.jsx("small",{children:"₽"})]})]})]}),e.jsxs("p",{className:u.text,children:["Ежемесячное списание Подписки со второго месяца будет равно стоимости Вашего тарифа ",r," ₽"]})]})};function Fe({price:r,id:a,item:o}){const i=o.clubs.filter(x=>x.id===a);if(!i)throw new Error("Нет данных по клубу");return e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(Se,{price:r,club:i[0]})})}const Ee=()=>{const{register:r,formState:{errors:a}}=S();return e.jsx(e.Fragment,{children:e.jsxs(t.Check,{type:"checkbox",id:"checkbox",children:[e.jsx(t.Check.Input,{type:"checkbox",className:a.isCheck?"is-invalid":"",...r("isCheck",{required:!0})}),e.jsxs(t.Check.Label,{className:s.labelCheck,children:["Я ознакомлен(-на) и согласен(-на) с условиями"," ",e.jsx(T,{to:"https://market.fitnesshouse.ru/storage/documents/oferta.pdf",className:s.link,target:"_blank",rel:"noreferrer",children:"Договора Оферты"}),","," ",e.jsx(T,{to:"https://market.fitnesshouse.ru/storage/documents/pravila_cluba.pdf",className:s.link,target:"_blank",rel:"noreferrer",children:"Правилами Клуба"})," ","и даю своё согласие на"," ",e.jsx(T,{to:"https://market.fitnesshouse.ru/storage/documents/legal_information.pdf",className:s.link,target:"_blank",rel:"noreferrer",children:"обработку персональных данных"}),"."]}),a.isCheck&&e.jsx(t.Text,{className:"text-danger",children:"Пожалуйста, заполните поле"})]})})},R=new Headers;R.append("Content-Type","application/json");const Le=oe.injectEndpoints({endpoints:r=>({createOrder:r.mutation({query:a=>({headers:R,redirect:"follow",url:window.location.hostname==="localhost"?"http://127.0.0.1:4173/payments/orders/":window.location.origin+"/payments/orders/",method:"POST",body:JSON.stringify(a),validateStatus:(o,i)=>((o.status===200||o.status===302)&&i.pay_url&&(window.location=i.pay_url),(o.status===200||o.status===302)&&!i.isError)}),extraOptions:{maxRetries:0},transformResponse:a=>a.body})}),overrideExisting:!1}),{useCreateOrderMutation:De}=Le,O={firstName:"",lastName:"",phone:"",email:"",birth_day:"",club_id:"",isCheck:!1},Pe=({item:r})=>{const[a,o]=b.useState(!1),{getProductsPosition:i,getClubsPositions:x,getProductsPositionFirstPay:p,getFormData:m,getCustomer:N}=ie(),[y]=De(),j=[1,2,3],[h,_]=b.useState(!1),[l,d]=b.useState(1),[f,k]=b.useState(O),[B,G]=b.useState(""),F=X({mode:"onTouched"}),{formState:{isValid:C,isDirty:v},watch:g,reset:M}=F,A=()=>{d(n=>n+1)},V=()=>{d(n=>n-1)},H=n=>{n=g(),k(n),V(),m(g()),o(!1),console.log(C,v)},$=n=>{n=g(),k(n),A(),m(g()),l===2&&(o(!0),P(f,n,r),G(n.club_id))},E=n=>{_(!0),n=g(),m(g()),N(),x(r.clubs),i(r),p(n.club_id),o(!0);const L=P(f,n,r);y(L),console.log(L),M(),k(O),d(3),o(!1)},J=()=>l>3?null:l===3?e.jsx(z,{FallbackComponent:de,children:e.jsx(w,{onClick:E,outline:!0,style:"w-100 d-block",type:"button",disabled:!C||!v,children:"Оплатить"})}):e.jsx("div",{className:"d-flex flex-grow-1",children:e.jsx(w,{onClick:$,outline:!0,style:"w-100 d-block",type:"button",disabled:!C||!v,children:l===1?"Вперед":"Далее"})});return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:s.stepper,children:j.map(n=>e.jsx("div",{className:n<=l?c(s.stepperItem,s.active):s.stepperItem,children:e.jsx("span",{children:n})},n))}),e.jsx(Y,{...F,children:e.jsxs(t,{noValidate:!0,validated:a,onSubmit:E,className:"form-order-tariff",children:[l>=1&&e.jsx("div",{className:l===1?"":"d-none",children:e.jsx(Ne,{})}),l>=2&&e.jsx("div",{className:l===2?"":"d-none",children:e.jsx(ke,{data:f,item:r})}),l>=3&&e.jsx("div",{className:l===3?"":"d-none",children:e.jsx(Fe,{price:r.price,id:B,item:r})}),e.jsxs("div",{className:"d-flex gap-3 w-100",children:[l>=2&&e.jsx(w,{onClick:H,outline:!0,type:"button",disabled:!!(l===3&&h),children:"←"}),J()]}),l<=2&&e.jsx("div",{className:l===2||l===1?"":"d-none",children:e.jsx(Ee,{})})]})})]})},_t=()=>{var l;const r=U(),{clubsPoolYes:a,clubsPoolNo:o,clubsPremiere:i,tariffTypes:x,tariffsTabs:p,tariffsActiveTab:m}=q(d=>d.price),j=[{tab:p[0],list:i},{tab:p[1],list:a},{tab:p[2],list:o}].filter(d=>d.tab===m)[0].list,h=[];j.length>0&&h.push(I(j,x));const _=(l=h.flat(1))==null?void 0:l.find(d=>d.id===Number(r.id));return e.jsx(Pe,{item:_})};export{_t as default};
